<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-Control" CONTENT="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <meta name="format-detection" content="telephone=no" />
    <title>新疆物流服务平台</title>
    <link rel="stylesheet" type="text/css" href="../css/swiper.min.css"/>
    <link rel="stylesheet" type="text/css" href="../css/commin.css"/>
    <link rel="stylesheet" href="../css/setUp_departmentManage.css">
	<style>
		
	</style>
</head>
<body>
<!--部门管理-->

    <div class="rightContBox"  style="float: none">
    	<!--头部-->
    	<div class="boxHead">
    		<div class="headLeft">部门管理</div>
    		<div class="headRight cfRefresh">
    			<img src="../img/yh_refresh2.png"/>
    			<span>刷新</span>
    		</div>
    	</div>
    	<div class="record">
    		<!--<div></div>-->
			<div class="select displayNum" data-selectedindex="0"><span>显示条数</span><img src="../img/prl-select.jpg" alt="">
				<ul>
					<li data-index="1">10</li>
					<li data-index="2">20</li>
					<li data-index="3">30</li>
				</ul>
			</div>
			<div class="select displayNum" data-selectedindex="0"><span>排序方式</span><img src="../img/prl-select.jpg" alt="">
				<ul>
					<li data-index="1">10</li>
					<li data-index="2">20</li>
					<li data-index="3">30</li>
				</ul>
			</div>
    		<div style="width: 102px;" class="add_apartment">添加</div>
    	</div>
    	<div class="listBox">
			<table class="contentslist" >
				<thead>
				<tr>
					<th>部门名称</th>
					<th style="width: 123px;"></th>
					<th>职能描述</th>
					<th style="width: 40px;"></th>
					<!-- <th>角色数量</th>
					<th style="width:20px;"> </th> -->
					<th>成员数量</th>
					<th style="width: 20px;"></th>
					<th>添加时间</th>
					<th style="width: 20px;"></th>
					<th>是否启用</th>
					<th style="width:20px;"></th>
					<th>操作</th>
				</tr>
				</thead>
				<tbody id="apartmentListInfo">
					<!-- <tr>
						<td>销售部</td>
						<td></td>
						<td>暂无描述</td>
						<td></td>
						<td>10</td>
						<td></td>
						<td class="">10</td>
						<td></td>
						<td> 2017-09-23 10：30：23 </td>
						<td></td>
						<td class="chooseswitch">
							<input id="checked_1" type="checkbox" class="switch" />
							<label for="checked_1"></label>
						</td>
						<td></td>
						<td><a href="" class="lookover" style="color:#6ba1ff;">编辑</a><a href="" class="delect" style="color:#6ba1ff;">删除</a></td>
					</tr>
					<tr>
						<td>销售部</td>
						<td></td>
						<td>暂无描述</td>
						<td></td>
						<td>10</td>
						<td></td>
						<td class="">10</td>
						<td></td>
						<td> 2017-09-23 10：30：23 </td>
						<td></td>
						<td class="chooseswitch">
							<input id="checked_1" type="checkbox" class="switch" />
							<label for="checked_1"></label>
						</td>
						<td></td>
						<td><a href="" class="lookover" style="color:#6ba1ff;">编辑</a><a href="" class="delect" style="color: #6ba1ff;">删除</a></td>
					</tr> -->
				</tbody>
			</table>
		</div>

		<div class="" style="text-align: center;height: 75px;padding-top: 17px;margin-bottom: 0;border-top: 1px solid #ebe9ea;">
			<ul class="pagination" id="page1" style="position: static;margin-bottom: 0;"></ul>
			<div class="pageJump">
				<span class="allPageN">1/1</span>
				<i style="margin-left: 12px;">共<span class="total">1</span>页</i>，
				<span>到第</span>
				<input type="text" style="text-align: center;" />
				<span>页</span>
				<button type="button" class="button">GO</button>
			</div>
		</div>

	</div>

<script src="../js/jquery-3.2.1.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/swiper.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/common.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/pager.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/template.js"></script>

<script type="text/html" id="apartmentListTpl">
	<%for (i in list) {%>
	<tr>
		<td><%=list[i].ordName%></td>
		<td></td>
		<td>
			<%if (list[i].describe != '') {%>
			<%=list[i].describe%>
			<%} else {%>
			暂无描述
			<%}%>
		</td>
		<td></td>
		<!-- <td>10</td>
		<td></td> -->
		<td class=""><%=list[i].num%></td>
		<td></td>
		<td><%=list[i].addTime%></td>
		<td></td>
		<td class="chooseswitch">
			<%if (list[i].obligate1 == '0') {%>
			<input id="checked_" type="checkbox" class="switch" checked="" />
			<label for="checked_"+i></label>
			<%} else if (list[i].obligate1 == '1') {%>
			<input id="checked_"+i type="checkbox" class="switch" />
			<label for="checked_"+i></label>
			<%}%>
			
		</td>
		<td></td>
		<td><a href="" class="lookover" style="color:#6ba1ff;">编辑</a><a href="" class="delect" style="color: #6ba1ff;">删除</a></td>
	</tr>
	<%}%>
</script>

<script type="text/javascript" >
    //Iframe 的高度
    $(function () {
        window.parent.$("#Iframe").css("height","853");
    })

    $('.objListBox>div:nth-child(5n)').css('margin-right','0');
    Page({
        num: 200,
        elem: $('#page1'),
        callback: function(n) {
            console.log(n);
        }
    });


    var isFirst = true;

    var isSearch = 0;

    apartment_list(1, '', 10);

    // 部门列表
    function apartment_list(num, sort, size) {
        $('#apartmentListInfo').html('');
        $.ajax({
            url: pubIP + 'tLtDriverOrg/selectWLtDriverOrgList',
            type: 'post',
            headers: {
                Accept: "application/json; charset=utf-8",
                token: token
            },
            data: {
                companyId: companyId,
                page: num,
                size: size,
                sort: sort
            },
            cache: false,
            dataType: 'json',
            success: function (json) {
                console.log(json);

                if (json.code == 1) {
                    if (json.data.length != 0) {
                    	var str = '';
                        for (var i = 0; i < json.data.length; i++) {
                        
                            json.data[i].addTime = new Date(json.data[i].addTime).Format("yyyy-MM-dd hh:mm");

                            str += '<tr '+json.data[i].id+'>'
									+'<td>'+json.data[i].ordName+'</td>'
									+'<td></td>'
									
									if (json.data[i].describe != '') {
										str += '<td>'+json.data[i].describe+'</td>'
									} else {
										str += '<td>'+暂无描述+'</td>'
									}
									
									str += '<td></td>'
									+'<td class="">'+json.data[i].num+'</td>'
									+'<td></td>'
									+'<td>'+json.data[i].addTime+'</td>'
									+'<td></td>'
									+'<td class="chooseswitch">'
									if (json.data[i].obligate1 == '0') {
										str+='<input id="checked_'+i+'" type="checkbox" class="switch" checked="" />'
										+'<label for="checked_'+i+'"></label>'
									} else if (json.data[i].obligate1 == '1') {
										str+=+'<input id="checked_'+i+'" type="checkbox" class="switch" />'
										+'<label for="checked_'+i+'"></label>'
									}
										
									str += '</td>'
									+'<td></td>'
									+'<td><a href="" class="lookover" style="color:#6ba1ff;">编辑</a><a href="" class="delect" style="color: #6ba1ff;">删除</a></td>'
								+'</tr>'
                        }
						
                        $('#apartmentListInfo').html(str);

                        // var result = template('apartmentListTpl', {list: json.data});
                        // $('#apartmentListInfo').html(result);

                       
                        if (isSearch == 1) {
                            // if (isFirst) {

                                Page({
                                    num: json.totalPage,
                                    elem: $('#page1'),
                                    callback: function(n) {
                                        apartment_list(n, sort, size);
                                    }
                                });
                                
                                $('.total').text(json.totalPage);
                                isFirst = false;

                            // }

                            $('.allPageN').text(num+1+'/'+json.totalPage);
                        }

                        isSearch = 0;

                        if (isFirst) {

                            Page({
                                num: json.totalPage,
                                elem: $('#page1'),
                                callback: function(n) {
                                    apartment_list(n, sort, size);
                                }
                            });
                            
                            $('.total').text(json.totalPage);

                            isFirst = false;
                        }

                        $('.allPageN').text(num+'/'+json.totalPage);
                    } else {
                        $('.pageJump').css('display', 'none');    
                    }
                } else {
                    $('.pageJump').css('display', 'none');
                }

            },
            error: function (err) {
                console.log(err);
            }

        });
    }

    // 新增部门
    $(document).on('click', '.add_apartment', function() {

    	window.parent.showModelBox('.modelBox35');

    });

    // 添加部门
    $(window.parent.document).on('click', '.model35_ok_btn', function() {

    	var apartment_name = $(window.parent.document).find('.apartment_name').val();
    	var zhineng_descript = $(window.parent.document).find('.zhineng_descript').val();

    	$.ajax({
            url: pubIP + 'tLtDriverOrg/updateDriverOrg',
            type: 'post',
            headers: {
                Accept: "application/json; charset=utf-8",
                token: token
            },
            data: {
                ordName: apartment_name,
                describe: zhineng_descript
            },
            cache: false,
            dataType: 'json',
            success: function (json) {
                console.log(json);
                if (json.code == 1) {
                	$(window.parent.document).find('.innerSuccmsg').html('<span>添加成功！</span>');
                	window.parent.showModelBox('.all_error_alert');
                }
            },
            error: function(err){
            	console.log(err);
            }
        });
    });
    
    $(window.parent.document).on('click', '.all_error_alert .modelbtn', function() {
    	window.location.reload();
    });

</script>
</body>
</html>
